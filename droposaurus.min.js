;(function(t,e){if(typeof define==="function"&&define.amd)define(["jquery","./../body-toucher/body-toucher","./../gush/gush"],e);else if(typeof exports==="object")module.exports=e(require("jquery"),require("./../body-toucher/body-toucher"),require("./../gush/gush"));else{e(t.jQuery)}})(this,function(v,t,e,b){"use strict";v(function(){var a="catchDropdown",s={touchBody:true,jsxHandling:false};function d(t,e){this.element=t;this.jqElem=v(t);this.options=v.extend({},s,e);this._defaults=s;this._name=a;if(!this.jqElem.is(".droposaurusised"))this.init()}d.prototype={init:function(){var t=this.jqElem,h=this;if(this.options.touchBody)v.addBody();t.each(function(){var i=v(this),n=i.attr("data-ds-main-class")?i.attr("data-ds-main-class"):"main",l=i.attr("data-ds-subtext-class")?i.attr("data-ds-subtext-class"):"sub",t=i.attr("data-ds-placehold-class")?i.attr("data-ds-placehold-class"):"btn-dd-placeholder";if(i.prop("tagName")===b||i.prop("tagName").toUpperCase()!=="SELECT")return;var r=i.wrap('<div class="dropdown-wrapper'+(i.data("size")?" size"+i.data("size"):"")+'"></div>'),o=r.parent(),e=r.attr("id")||r.attr("name")||null,a=r.data("sourceId")||e+"-dd",s=a.replace(/[^A-Za-z0-9]+/g,"-"),d=h.uid(s),c=h.uid(d+"-label"),u=(r.attr("class")||"").replace("select-invisible",""),f='<label id="'+c+'" aria-hidden="true" class="'+(r.data("error ")?"error":"")+u+'">'+'<span class="span-label'+(r.data("hideLabel")?" hidden":"")+'">'+(!r.data("mobile-only-label")&&r.data("label")||"")+"</span>"+'<div class="btn-dd">'+'<a href="" id="'+d+'" class="input btn-dd-select phone-type icon-chevron-fat-down'+(r.attr("data-selected")?" populated":"")+'" tabindex="0">'+'<span class="'+n+" "+t+'"'+(r.data("placeholder-color")?' style="color:'+r.data("placeholder-color")+'"':"")+">"+r.data("placeholder")+"</span>"+(r.data("subtext")?"<span class='"+l+"'>"+r.data("subtext")+"</span>":"")+"</a>"+'<div class="btn-dd-options">'+(r.data("label")?'<div class="btn-dd-header">'+r.data("label")+' <a class="btn-dd-close">Close</a>'+"</div>":"")+"<ul></ul>"+"</div>"+"</div>"+"</label>";r.after(f);if(r.attr("data-ds-native-mobile")){r.off("change.nativeMirror").on("change.nativeMirror",function(t){if(t.originalEvent&&t.originalEvent.currentTarget==t.currentTarget){v('.catch-dropdown-item [data-value="'+t.target.value+'"]').trigger("click")}})}else{r.addClass("hidden")}h.update();o.find("ul").gush({x:false,move:{stopPropagation:true}});if(v.listen)v.listen("parsley:field:error",function(t){if(t.$element.attr("name")==i.attr("name")){v("#"+c).addClass("error")}});v("html").click(function(t){o.find(".btn-dd").removeClass("active");v("html").removeClass("s-dd-active");v.scrollElem(true).removeClass("no-overflow")});var p=-1;v(document).on("keydown.droposaur",function(t){if(t.keyCode==40){if(o.find(".btn-dd.active").length){t.preventDefault();var e=o.find(".btn-dd-option a");if(p<e.length-1){p++}var a=e[p];a.focus();r.find('option[value="'+v(a).data("value")+'"]').prop("selected",true);h.updateAttrs();r.trigger("change");r.trigger("changeDrop",[v(a).data("value")]);i.removeClass("error")}}else if(t.keyCode==38){if(o.find(".btn-dd.active").length){t.preventDefault();var e=o.find(".btn-dd-option a");if(p>0){p--}var a=e[p];a.focus();r.find('option[value="'+v(a).data("value")+'"]').prop("selected",true);h.updateAttrs();r.trigger("change");r.trigger("changeDrop",[v(a).data("value")]);i.removeClass("error")}}else if(t.keyCode==9){var s=o.find(".btn-dd.active");if(s.length){var d=r.find('option[value="'+r.val()+'"]');t.preventDefault();s.removeClass("active");v("html").removeClass("s-dd-active");v.scrollElem(true).removeClass("no-overflow");s.find("a").first().addClass("populated");s.find("a").first().focus();s.find("a ."+n).first().text(d.attr("data-main-text")||d.text());if(s.find("a ."+l).length==0){s.find("a").append('<span class="'+l+'"></span>')}s.find("a ."+l).first().text(r.data("subtext")||d.data("subtext")||"")}}else if(t.keyCode==13){var s=o.find(".btn-dd.active");if(s.length){var d=r.find('option[value="'+r.val()+'"]');t.preventDefault();s.removeClass("active");v("html").removeClass("s-dd-active");v.scrollElem(true).removeClass("no-overflow");s.find("a").first().addClass("populated");s.find("a").first().focus();s.find("a ."+n).first().text(d.attr("data-main-text")||d.text());if(s.find("a ."+l).length==0){s.find("a").append('<span class="'+l+'"></span>')}s.find("a ."+l).first().text(r.data("subtext")||d.data("subtext")||"")}}})});this.jqElem.addClass("droposaurusised").trigger("droposaurusised")},uid:function(t){var e=2,a=t;while(!a||v("#"+a).length){a=t+e;e++}return a},update:function(t){var e=this.jqElem,p=this,n=e.attr("data-ds-main-class")?e.attr("data-ds-main-class"):"main",l=e.attr("data-ds-subtext-class")?e.attr("data-ds-subtext-class"):"sub",r=e.attr("data-ds-placehold-class")?e.attr("data-ds-placehold-class"):"btn-dd-placeholder",a,s,d;e.each(function(){var u=v(this),f=u.closest(".dropdown-wrapper");if(typeof t=="object"){u.html("");for(d=0;d<t.length;d++){s=t[d];u.append('<option value="'+s.value+'" data-subtext="'+s.subtext+'">'+(s.innerHTML?s.innerHTML:s.value)+"<option>")}}else if(typeof t=="string"){u.html(t)}f.find("ul").html("");if(u.attr("allow-empty")=="true"||u.attr("data-allow-empty")=="true"){u.prepend('<option value=""></option>');f.find("ul").append('<li class="dd-empty-option input btn-dd-option catch-dropdown-item"><a class="catch-dropdown-link" href="" tabindex="-1" data-value=""></a></li>')}u.find("option").each(function(t){var e=v(this),a=e.attr("data-main-text")?e.attr("data-main-text"):e.text(),s=p.jqElem.attr("id")||p.jqElem.attr("name")||null,d=(s+"-"+e.val()+"-"+t).replace(/[^A-Za-z0-9]+/g,"-"),i=p.uid(d),n=u.attr("data-ds-main-class")?u.attr("data-ds-main-class"):"main",l=u.attr("data-ds-subtext-class")?u.attr("data-ds-subtext-class"):"sub",r=p.uid(i+"-trigger"),o=e.attr("value")===b?"":e.attr("value"),c=u.attr("data-selected")===b?"":u.attr("data-selected");if(e.text()!=""){f.find("ul").append('<li id="'+i+'" '+'class="input btn-dd-option catch-dropdown-item">'+'<a class="catch-dropdown-link'+(a=="Add Connection"?" btn--add btn--icon icon-add icon-after":"")+(c==o?" selected":"")+'" '+'id="'+r+'"'+'href="" '+'tabindex="-1" '+'data-value="'+o+'">'+'<span class="'+n+'">'+a+"</span>"+(e.data("subtext")?'<span class="'+l+'">'+e.data("subtext")+"</span>":"")+"</a>"+"</li>")}});if(u.attr("data-selected")===b){a=u.find("option[selected]");if(!a){u.find("option").each(function(){var t=v(this);if(t.prop("selected"))a=t})}if(!a.length)a=u.find('option[value="'+u.val()+'"]');if(!a.length)a=u.find("option").first()}else{a=u.find('option[value="'+u.attr("data-selected")+'"]');if(!a.length){u.find("option").each(function(){var t=v(this).attr("value")===b?"":v(this).attr("value");if(u.attr("data-selected")==t)a=v(this)})}}a.prop("selected",true);p.updateAttrs();u.trigger("change");v(this).removeClass("error");f.find(".btn-dd-select ."+n).first().text(a.attr("data-main-text")||a.text()||u.data("placeholder")||"");if(f.find(".btn-dd-select ."+l).length==0){f.find(".btn-dd-select").append("<span class="+l+"></span>")}f.find(".btn-dd-select ."+l).first().text(a.data("subtext")||u.data("subtext")||"");f.find(".btn-dd").off("click.droposaur").on("click.droposaur",function(t){t.preventDefault();t.stopPropagation();if(v(this).hasClass("disabled")){return}if(!v(this).hasClass("active")){v(".btn-dd").removeClass("active")}u.trigger("probable_change");v(this).closest(".catch-dropdown").removeClass("error");var e=u.val();v(this).find("li a").each(function(){v(this).toggleClass("selected",e==v(this).data("value"))});v(this).toggleClass("active");v("html").toggleClass("s-dd-active");v.scrollElem(true).toggleClass("no-overflow");v(this).find("a").first().addClass("populated")});f.find("li a").off("click.droposaur").on("click.droposaur",function(t){t.preventDefault();t.stopPropagation();var e=u.find('option[value="'+v(this).data("value")+'"]').prop("selected",true),a=f.find(".btn-dd-select ."+n).first();p.updateAttrs();a.text(v(this).find("."+n).text()).removeClass(r);if(f.find(".btn-dd-select ."+l).length==0){f.find(".btn-dd-select").append('<span class="'+l+'"></span>')}f.find(".btn-dd-select ."+l).first().text(u.data("subtext")||e.data("subtext")||"");if(u.attr("data-droposaur-firenative")&&p.options.jsxHandling){var s="change",d=u[0],i;if(typeof window.CustomEvent==="function"){d.dispatchEvent(new Event(s,{bubbles:true,cancelable:true}))}else if(document.createEvent){i=document.createEvent("Event");i.initEvent(s,true,true);d.dispatchEvent(i)}else{i=document.createEventObject();d.fireEvent("on"+s,i)}}else{u.trigger("change")}v(this).closest(".catch-dropdown").removeClass("error");v("html").removeClass("s-dd-active");v.scrollElem(true).removeClass("no-overflow");f.find(".btn-dd").removeClass("active").find("a").first().addClass("populated")})})},updateAttrs:function(){this.jqElem.find("option").each(function(){v(this).prop("selected")?v(this).attr("selected","selected"):v(this).removeAttr("selected")})},setDisabled:function(t){this.jqElem.parent().find(".btn-dd").toggleClass("disabled",t)}};v.fn[a]=function(t,e){return this.each(function(){if(!v.data(this,"plugin_"+a)){v.data(this,"plugin_"+a,new d(this,t))}else if(t=="update"){v.data(this,"plugin_"+a).update(e)}else if(t=="setDisabled"){v.data(this,"plugin_"+a).setDisabled(e)}})}})});
